<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedRecordDot #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Module      : Reddit.Example</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Description : An example of a simple Reddit bot built using this library</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Copyright   : (c) Penelope Y. 2023</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- License     : MIT</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Maintainer  : penelopeysm@gmail.com</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- When run, this script will log each new comment posted in @\/r\/haskell@ to</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- standard output, scans it for the phrase @&quot;Haskell is great!!!!!!!!!&quot;@, and</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- if that is found, replies to them with @&quot;Indeed, it is!&quot;@. (I put in 9</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- exclamation marks because I don't want to be morally responsible for somebody</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- gratuitously importing it, running it, and spamming the sub.)</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- Anyway, you should look at the source code for this module instead of the</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- built Haddocks. It contains many explanatory comments.</span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Reddit.Example</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">threadDelay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">catch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">when</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier">Data.Text.IO</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Reddit.html"><span class="hs-identifier">Reddit</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">System.Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">getEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">System.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">stderr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- | 'System.Environment.getEnv' but acts on 'Data.Text.Text' values.</span><span>
</span><span id="line-34"></span><span class="annot"><a href="Reddit.Example.html#getEnvAsText"><span class="hs-identifier hs-type">getEnvAsText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-type">T.Text</span></a></span><span>
</span><span id="line-35"></span><span id="getEnvAsText"><span class="annot"><span class="annottext">getEnvAsText :: Text -&gt; IO Text
</span><a href="Reddit.Example.html#getEnvAsText"><span class="hs-identifier hs-var hs-var">getEnvAsText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">getEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-var">T.unpack</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- | An example of a callback function acting on comments. It takes an 'Int'</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- input state, the comment it sees, and does some kind of action on Reddit that</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- ultimately returns another 'Int'. The returned value will be used as the</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- input the next time the callback is executed, i.e. on the next comment.</span><span>
</span><span id="line-41"></span><span class="annot"><a href="Reddit.Example.html#replyIfHaskellGreat"><span class="hs-identifier hs-type">replyIfHaskellGreat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Reddit.Types.html#Comment"><span class="hs-identifier hs-type">Comment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Reddit.html#RedditT"><span class="hs-identifier hs-type">RedditT</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-42"></span><span id="replyIfHaskellGreat"><span class="annot"><span class="annottext">replyIfHaskellGreat :: Int -&gt; Comment -&gt; RedditT Int
</span><a href="Reddit.Example.html#replyIfHaskellGreat"><span class="hs-identifier hs-var hs-var">replyIfHaskellGreat</span></a></span></span><span> </span><span id="local-6989586621679091044"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679091044"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span id="local-6989586621679091043"><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679091043"><span class="hs-identifier hs-var">cmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-comment">-- Print details about the comment on standard output</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091038"><span class="annot"><span class="annottext">p :: Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-var">T.putStrLn</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Found new comment!&quot;</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;By    : /u/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679091043"><span class="hs-identifier hs-var">cmt</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">author</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Link  : &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679091043"><span class="hs-identifier hs-var">cmt</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">url</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Text  : &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679091043"><span class="hs-identifier hs-var">cmt</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">body</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Comments seen so far: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679091044"><span class="hs-identifier hs-var">count</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091034"><span class="annot"><span class="annottext">triggerText :: Text
</span><a href="#local-6989586621679091034"><span class="hs-identifier hs-var hs-var">triggerText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Haskell is great!!!!!!!!&quot;</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091032"><span class="annot"><span class="annottext">replyText :: Text
</span><a href="#local-6989586621679091032"><span class="hs-identifier hs-var hs-var">replyText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Indeed, it is!&quot;</span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-comment">-- Check whether it contains the trigger text, and reply if necessary</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">when</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091034"><span class="hs-identifier hs-var">triggerText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-operator hs-var">`T.isInfixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679091043"><span class="hs-identifier hs-var">cmt</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">body</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ReaderT RedditEnv IO ()
</span><a href="#local-6989586621679091038"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Replying to it...&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. CanCommentOn a =&gt; ID a -&gt; Text -&gt; ReaderT RedditEnv IO ()
</span><a href="Reddit.html#addNewComment"><span class="hs-identifier hs-var">addNewComment</span></a></span><span> </span><span class="annot"><span class="annottext">Comment
</span><a href="#local-6989586621679091043"><span class="hs-identifier hs-var">cmt</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">id'</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091032"><span class="hs-identifier hs-var">replyText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679091044"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Run the bot.</span><span>
</span><span id="line-61"></span><span class="annot"><a href="Reddit.Example.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span id="main"><span class="annot"><span class="annottext">main :: IO ()
</span><a href="Reddit.Example.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-comment">-- Read in your secrets from environment variables (or wherever you like).</span><span>
</span><span id="line-64"></span><span>  </span><span id="local-6989586621679091027"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091027"><span class="hs-identifier hs-var">username</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Text
</span><a href="Reddit.Example.html#getEnvAsText"><span class="hs-identifier hs-var">getEnvAsText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;REDDIT_USERNAME&quot;</span></span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621679091026"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091026"><span class="hs-identifier hs-var">password</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Text
</span><a href="Reddit.Example.html#getEnvAsText"><span class="hs-identifier hs-var">getEnvAsText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;REDDIT_PASSWORD&quot;</span></span><span>
</span><span id="line-66"></span><span>  </span><span id="local-6989586621679091025"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091025"><span class="hs-identifier hs-var">clientID</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Text
</span><a href="Reddit.Example.html#getEnvAsText"><span class="hs-identifier hs-var">getEnvAsText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;REDDIT_ID&quot;</span></span><span>
</span><span id="line-67"></span><span>  </span><span id="local-6989586621679091024"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091024"><span class="hs-identifier hs-var">clientSecret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Text
</span><a href="Reddit.Example.html#getEnvAsText"><span class="hs-identifier hs-var">getEnvAsText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;REDDIT_SECRET&quot;</span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091022"><span class="annot"><span class="annottext">userAgent :: Text
</span><a href="#local-6989586621679091022"><span class="hs-identifier hs-var hs-var">userAgent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;your user-agent here&quot;</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-comment">-- The next line can be shortened with RecordWildCards if you want.</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091021"><span class="annot"><span class="annottext">creds :: Credentials
</span><a href="#local-6989586621679091021"><span class="hs-identifier hs-var hs-var">creds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><a href="Reddit.html#Credentials"><span class="hs-identifier hs-type">Credentials</span></a></span><span>
</span><span id="line-72"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">username :: Text
</span><a href="Reddit.html#username"><span class="hs-identifier hs-var">username</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091027"><span class="hs-identifier hs-var">username</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>            </span><span class="annot"><span class="annottext">password :: Text
</span><a href="Reddit.html#password"><span class="hs-identifier hs-var">password</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091026"><span class="hs-identifier hs-var">password</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>            </span><span class="annot"><span class="annottext">clientID :: Text
</span><a href="Reddit.html#clientID"><span class="hs-identifier hs-var">clientID</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091025"><span class="hs-identifier hs-var">clientID</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>            </span><span class="annot"><span class="annottext">clientSecret :: Text
</span><a href="Reddit.html#clientSecret"><span class="hs-identifier hs-var">clientSecret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091024"><span class="hs-identifier hs-var">clientSecret</span></a></span><span>
</span><span id="line-76"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-comment">-- Get the RedditEnv term needed to run Reddit queries.</span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621679091015"><span class="annot"><span class="annottext">RedditEnv
</span><a href="#local-6989586621679091015"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Credentials -&gt; Text -&gt; IO RedditEnv
</span><a href="Reddit.html#withCredentials"><span class="hs-identifier hs-var">withCredentials</span></a></span><span> </span><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679091021"><span class="hs-identifier hs-var">creds</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679091022"><span class="hs-identifier hs-var">userAgent</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-comment">-- Run the bot, refreshing every 5 seconds (the default).</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><span class="annottext">forall a. RedditEnv -&gt; RedditT a -&gt; IO a
</span><a href="Reddit.html#runRedditT%27"><span class="hs-identifier hs-var">runRedditT'</span></a></span><span> </span><span class="annot"><span class="annottext">RedditEnv
</span><a href="#local-6989586621679091015"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">forall state.
(state -&gt; Comment -&gt; RedditT state)
-&gt; state -&gt; Text -&gt; ReaderT RedditEnv IO ()
</span><a href="Reddit.html#commentStream"><span class="hs-identifier hs-var">commentStream</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Comment -&gt; RedditT Int
</span><a href="Reddit.Example.html#replyIfHaskellGreat"><span class="hs-identifier hs-var">replyIfHaskellGreat</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;haskell&quot;</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-comment">-- commentStream is a recursive function and, in principle, should never end.</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-comment">-- However, the implementation above is quite naive: in practice you have to</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-comment">-- account for exceptions, not least because Reddit servers seem to break</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-comment">-- about once every day. The easiest way to do this is to use the combinators</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-comment">-- in Control.Exception. The method shown here is quite crude, see e.g. the</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- Control.Exception docs, or Neil Mitchell's blog post</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- http://neilmitchell.blogspot.com/2015/05/handling-control-c-in-haskell.html</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-comment">-- for a better discussion.</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- There is a related issue, in that you can't extract the value of `count` so</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">-- far if an exception is raised. If you wanted to do this properly, you</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-comment">-- probably need to use something like a `Data.IORef` to store the value of</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-comment">-- `count`.</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-comment">-- Finally, note that, even though this nominally catches Ctrl-C exceptions,</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-comment">-- you can still kill the bot by pressing Ctrl-C twice:</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-comment">-- https://stackoverflow.com/questions/2349233</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679091011"><span class="annot"><span class="annottext">protectedAction :: IO ()
</span><a href="#local-6989586621679091011"><span class="hs-identifier hs-var hs-var">protectedAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>        </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">catch</span></a></span><span>
</span><span id="line-103"></span><span>          </span><span class="hs-comment">-- The original action</span><span>
</span><span id="line-104"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. RedditEnv -&gt; RedditT a -&gt; IO a
</span><a href="Reddit.html#runRedditT%27"><span class="hs-identifier hs-var">runRedditT'</span></a></span><span> </span><span class="annot"><span class="annottext">RedditEnv
</span><a href="#local-6989586621679091015"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall state.
(state -&gt; Comment -&gt; RedditT state)
-&gt; state -&gt; Text -&gt; ReaderT RedditEnv IO ()
</span><a href="Reddit.html#commentStream"><span class="hs-identifier hs-var">commentStream</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Comment -&gt; RedditT Int
</span><a href="Reddit.Example.html#replyIfHaskellGreat"><span class="hs-identifier hs-var">replyIfHaskellGreat</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;haskell&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>          </span><span class="hs-comment">-- If we get an exception, print it, wait 5 seconds, then try again.</span><span>
</span><span id="line-106"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679091010"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679091010"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>              </span><span class="annot"><span class="annottext">Handle -&gt; Text -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-var">T.hPutStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">stderr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Exception: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/text-1.2.5.0/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679091010"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>              </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5000000</span></span><span>
</span><span id="line-109"></span><span>              </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679091011"><span class="hs-identifier hs-var">protectedAction</span></a></span><span>
</span><span id="line-110"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679091011"><span class="hs-identifier hs-var">protectedAction</span></a></span><span>
</span><span id="line-112"></span></pre></body></html>